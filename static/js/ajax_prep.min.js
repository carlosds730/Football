function csrfSafeMethod(e) {
    return /^(GET|HEAD|OPTIONS|TRACE)$/.test(e)
}
function sameOrigin(e) {
    var t = document.location.host, n = document.location.protocol, o = "//" + t, i = n + o;
    return e == i || e.slice(0, i.length + 1) == i + "/" || e == o || e.slice(0, o.length + 1) == o + "/" || !/^(\/\/|http:|https:).*/.test(e)
}
function getCookie(e) {
    var t = null;
    if (document.cookie && "" != document.cookie)for (var n = document.cookie.split(";"), o = 0; o < n.length; o++) {
        var i = jQuery.trim(n[o]);
        if (i.substring(0, e.length + 1) == e + "=") {
            t = decodeURIComponent(i.substring(e.length + 1));
            break
        }
    }
    return t
}
function getWidth() {
    var e = 0;
    return "number" == typeof document.body.clientWidth ? e = document.body.clientWidth : "number" == typeof window.innerWidth ? e = window.innerWidth : document.documentElement && document.documentElement.clientWidth && (e = document.documentElement.clientWidth), e
}
function getHeight() {
    var e = 0;
    return "number" == typeof window.innerHeight ? e = window.innerHeight : document.documentElement && document.documentElement.clientHeight && (e = document.documentElement.clientHeight), e
}
function insert_comments(e, t, n) {
    for (var o = document.getElementById("comentarios"), i = 0; i < e.comentarios.length; i++) {
        var a = e.comentarios[i], m = document.createElement("div");
        m.classList.add("comentario"), m.id = a[2], 1 == t || void 0 == o.firstChild || null == o.firstChild ? o.appendChild(m) : o.insertBefore(m, o.firstChild);
        var r = document.createElement("p");
        "es" == n ? r.innerHTML = a[3] + " " + a[0] + " comentó" : r.innerHTML = a[3] + " " + a[0] + " commented", m.appendChild(r);
        var d = document.createElement("p");
        if (d.textContent = a[1], m.appendChild(d), $("#" + a[2]).fadeIn(750), document.getElementById(!0)) {
            var l = parseInt(document.getElementById("number_comentarios").innerText, 10) + 1;
            document.getElementById("number_comentarios").innerText = l.toString()
        }
    }
    var c = $("#number_comentarios");
    c.length > 0 && (c[0].innerText = parseInt(c[0].innerText, 10) + e.comentarios.length)
}
function updateComments(e, t) {
    var n = $("#comentarios").find("> div:first")[0];
    n = void 0 == n ? -1 : n.id;
    var o = $.post("/ajax_noticias/" + e + "/", {pk_last_comment: n, language: t});
    o.done(function (e) {
        insert_comments(e, !1, t)
    })
}
function insert_commentsImg(e, t, n, o) {
    for (var i = 0; i < e.comentarios.length; i++) {
        var a = e.comentarios[i], m = document.createElement("div");
        m.classList.add("comentario"), m.id = a[2], 1 == t || void 0 == n.firstChild || null == n.firstChild ? n.appendChild(m) : n.insertBefore(m, n.firstChild);
        var r = document.createElement("p");
        "es" == o ? r.innerHTML = a[3] + " " + a[0] + " comentó" : r.innerHTML = a[3] + " " + a[0] + " commented", m.appendChild(r);
        var d = document.createElement("p");
        if (d.textContent = a[1], m.appendChild(d), $("#" + a[2]).fadeIn(750), document.getElementById(!0)) {
            var l = parseInt(document.getElementById("number_comentarios").innerText, 10) + 1;
            document.getElementById("number_comentarios").innerText = l.toString()
        }
    }
    var c = $("#number_comentarios");
    c.length > 0 && (c[0].innerText = parseInt(c[0].innerText, 10) + e.comentarios.length)
}
function updateCommentsImageNode(e, t, n) {
    var o = $("#comentarios").find("> div:first"), i = $("#no_comments_title");
    0 == o.length ? (o = -1, 0 == i.length) : o = o[0].id;
    var a = $.post("/imagen/" + e + "/", {pk_last_comment: o, language: t});
    a.done(function (e) {
        var i = $("#no_comments_title");
        if (-1 == o && 0 == i.length && 0 == e.comentarios.length) {
            var a = document.createElement("h5");
            a.id = "no_comments_title", "es" == t ? a.innerText = "Esta imagen no tiene comentarios ¡Se el primero en comentar!" : a.innerText = "This imagen has no comments. Be the first to comment!", document.getElementById("comentarios").appendChild(a)
        } else i.length > 0 && e.comentarios.length > 0 && (i.fadeOut("slow"), i.remove());
        insert_commentsImg(e, !1, n, t)
    })
}
function updateCommentsImage(e, t) {
    var n = $("#comentarios").find("> div:first"), o = $("#no_comments_title");
    0 == n.length ? (n = -1, 0 == o.length) : n = n[0].id;
    var i = $.post("/imagen/" + e + "/", {pk_last_comment: n, language: t});
    i.done(function (e) {
        var o = $("#no_comments_title");
        if (-1 == n && 0 == o.length && 0 == e.comentarios.length) {
            var i = document.createElement("h5");
            i.id = "no_comments_title", "es" == t ? i.innerText = "Esta imagen no tiene comentarios ¡Se el primero en comentar!" : i.innerText = "This imagen has no comments. Be the first to comment!", document.getElementById("comentarios").appendChild(i)
        } else o.length > 0 && e.comentarios.length > 0 && (o.fadeOut("slow"), o.remove());
        insert_commentsImg(e, !1, document.getElementById("comentarios"), t)
    })
}
function validateEmail(e) {
    var t;
    return t = /(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)])/, t.test(e)
}
function emailValidationOnTheFly(e) {
    validateEmail(e.value) ? e.style.color = "green" : e.style.color = "red"
}
function CookiesName(e) {
    var t = getCookie("buenviaje_usuario");
    null != t && (void 0 != t.split('"')[1] ? e.value = t.split('"')[1] : e.value = t)
}
function CookiesEmail(e) {
    var t = getCookie("buenviaje_correo");
    null != t && (e.value = t.split('"')[1])
}
function CookiesNotify() {
    var e = getCookie("buenviaje_notify");
    notifyme && null != e && (notify_node.checked = !0)
}
function CookiesJob() {
    var e = getCookie("buenviaje_usuario");
    null != e && (void 0 != e.split('"')[1] ? document.getElementById("POST-name").value = e.split('"')[1] : document.getElementById("POST-name").value = e);
    var t = getCookie("buenviaje_correo");
    null != t && (document.getElementById("POST-email").value = t.split('"')[1]);
    var n = getCookie("buenviaje_notify");
    null != n && (document.getElementById("checkbox").checked = !0)
}
function show_node(e, t, n, o) {
    var i = document.createElement("div");
    i.id = "big_div";
    var a = document.createElement("div");
    a.id = "background_div", a.onclick = function () {
        $("#big_div").fadeOut("slow", function () {
            var i = document.getElementById("big_div");
            e.classList.remove("container_div"), e.style.display = "none", t && document.getElementsByTagName("body")[0].appendChild(e), n && document.getElementsByTagName("body")[0].appendChild(document.getElementById(n)), clearInterval(pictureInterval), o(), document.getElementsByTagName("body")[0].removeChild(i)
        })
    }, e.classList.add("container_div"), i.appendChild(a), i.appendChild(e), document.getElementsByTagName("body")[0].appendChild(i), e.style.display = "block", $("#big_div").fadeIn("slow")
}
function prep_the_pictures(e, t, n) {
    for (var o = document.getElementById("demo" + e), i = 0; i < t.length; i++) {
        var a = document.createElement("div");
        a.className = "item", a.setAttribute("data-w", t[i][0][1]), a.setAttribute("data-h", t[i][0][2]), a.setAttribute("data-id", t[i][2]), a.setAttribute("data-width_big", t[i][3][1]), a.setAttribute("data-height_big", t[i][3][2]), a.setAttribute("data-src_big", t[i][3][0]), a.setAttribute("data-usuario", t[i][4]), a.setAttribute("data-description", t[i][5]), a.setAttribute("rel", "tooltip"), a.setAttribute("data-trigger", "hover"), a.setAttribute("data-html", "True"), "es" == n ? a.setAttribute("data-original-title", "<p>" + t[i][5] + "</p><p>Subida por " + t[i][4] + "</p> <p>" + t[i][1] + " comentarios</p>") : a.setAttribute("data-original-title", "<p>" + t[i][5] + "</p><p>Uploaded by " + t[i][4] + "</p> <p>" + t[i][1] + " comments</p>");
        var m = document.createElement("img");
        m.src = t[i][0][0];
        var r = document.createElement("a");
        r.setAttribute("href", "/imagen/" + t[i][2] + "/#img_container_big"), a.appendChild(r), r.appendChild(m), r.onclick = modal_launcher(a, n), o.appendChild(a)
    }
    $("[rel=tooltip]").tooltip(), $("#demo" + e).fadeIn("slow").flexImages({rowHeight: 200})
}
function modal_launcher(e, t) {
    return function () {
        var n = e.getAttribute("data-id"), o = e.getAttribute("data-width_big"), i = e.getAttribute("data-height_big"), a = e.getAttribute("data-src_big"), m = e.getAttribute("data-usuario"), r = e.getAttribute("data-description");
        if (parseInt(o, 10) + 80 + 520 < getWidth()) {
            var d = getHeight() - (parseInt(i, 10) + 144);
            if (d > 20)return prep_img_modal(n, o, i, a, m, r, t, d), !1
        }
        e.firstChild.href = "/imagen/" + n + "/?languague=es&width=" + getWidth() + "&height=" + getHeight() + "#img_container_big"
    }
}
function submitFunction(e, t, n) {
    return function () {
        var o = document.getElementById("textarea").value, i = document.getElementById("POST-name").value, a = document.getElementById("POST-email").value, m = document.getElementById("checkbox").checked;
        if ("" == o)return $("#textarea").tooltip("show"), hideTooltipMessage("textarea"), !1;
        if ("" == i && "" == a)return $("#POST-name").tooltip("show"), hideTooltipMessage("POST-name"), !1;
        if (1 == m && "" == a)return $("#checkbox").tooltip("show"), hideTooltipMessage("checkbox"), !1;
        var r = $("#comentarios").find("> div:first")[0];
        if (r = void 0 == r ? -1 : r.id, 1 == m)var d = $.post("/imagen/" + e + "/", {
            texto: o,
            nombre: i,
            email: a,
            pk_last_comment: r,
            noti: "true",
            language: n
        }); else var d = $.post("/imagen/" + e + "/", {texto: o, nombre: i, email: a, pk_last_comment: r, language: n});
        return d.done(function (e) {
            if (e.error)$("#POST-email").tooltip("show"), hideTooltipMessage("POST-email"); else {
                document.getElementById("textarea").value = "";
                var o = $("#no_comments_title");
                o.length > 0 && (o.fadeOut("slow"), o.remove()), insert_commentsImg(e, !1, t, n)
            }
        }), !1
    }
}
function prep_img_modal(e, t, n, o, i, a, m, r) {
    var d = document.createElement("div");
    d.classList.add("my_modal_div"), d.style.top = r / 4 + "px";
    var l = document.createElement("div");
    l.id = "comentarios";
    var c = document.createElement("input");
    c.type = "submit", c.classList.add("form-control"), c.classList.add("btn"), c.classList.add("default-btn"), c.classList.add("img_form_element"), "es" == m ? c.value = "Comentar" : c.value = "Comment", c.id = "submit", c.onclick = submitFunction(e, l, m), document.getElementById("comment_form").insertBefore(c, document.getElementById("checkbox"));
    var s = document.createElement("div");
    s.classList.add("img_left_container"), s.style.width = parseInt(t, 10) + "px";
    var u = document.createElement("img");
    u.src = o;
    var g = document.createElement("p");
    g.innerText = a;
    var p = document.createElement("p");
    "es" == m ? p.innerHTML = "<strong>Imagen subida por </strong>" + i : p.innerHTML = "<strong>Uploaded by </strong>" + i, s.appendChild(u), s.appendChild(g), s.appendChild(p);
    var h = document.createElement("div");
    h.classList.add("comm_right_container"), h.style.width = "520px";
    var v = document.getElementById("comment_form");
    v.style.display = "block", l.classList.add("comm_right_container"), l.style.height = parseInt(n, 10) + 5 + "px", l.style.border = "0px", h.appendChild(l), h.appendChild(v), d.style.width = parseInt(t, 10) + 80 + 520 + "px", d.appendChild(s), d.appendChild(h), updateCommentsImageNode(e, m, l), pictureInterval = setInterval(function () {
        updateCommentsImageNode(e, m, l)
    }, 1e4), show_node(d, !1, "comment_form", function () {
        document.getElementById("comment_form").removeChild(document.getElementById("submit")), document.getElementById("comment_form").style.display = "none"
    }), CookiesJob()
}
function hideTooltipMessage(e) {
    window.setTimeout(function () {
        $("#" + e).tooltip("hide")
    }, 1500)
}
var csrftoken = getCookie("csrftoken");
$.ajaxSetup({
    beforeSend: function (e, t) {
        !csrfSafeMethod(t.type) && sameOrigin(t.url) && e.setRequestHeader("X-CSRFToken", csrftoken)
    }
});
